{{- $providerConfigName := tpl .Values.providerConfig.name $ | required ".Values.providerConfig.name is required" }}
{{- $realmName := tpl .Values.realm.name $ }}
{{- $realmResourceName := printf "%s-%s--realm" $realmName .Release.Namespace }}
{{- $realmNamespace := .Release.Namespace }}

{{- range $role := .Values.roles }}
{{- $roleName := tpl $role.forProvider.name $ | required "$role.*.forProvider.name is required" }}
{{- $roleDescription := $role.forProvider.description | required (printf "$role.%s.description is required" $role.name) }}

---
apiVersion: role.keycloak.m.crossplane.io/v1alpha1
kind: Role
metadata:
  name: "{{ $realmName }}--{{ $role.name }}--{{ $realmNamespace }}"
  namespace: "{{ $realmNamespace }}"
spec:
  providerConfigRef:
    name: "{{ $providerConfigName }}"
  forProvider:
    realmIdRef:
      name: "{{ $realmResourceName }}"
      namespace: "{{ $realmNamespace }}"
    {{- tpl ($role.forProvider | toYaml) $ | nindent 4 }}
{{- end }}
